{"name":"First GitHub Page","tagline":"GitHub Pages site","body":"---\r\nlayout: default\r\ntitle: Ruby Girls Cloud9 Sinatra App - The Why?\r\npermalink: sinatra-app-guide-why\r\n---\r\n\r\n# Ruby Girls Sinatra App Guide\r\n\r\n*Created by Sorcha Abel, [@sabel25](https://twitter.com/sabel25)*\r\n\r\n## What is Sinatra?\r\n<img src=\"/images/sinatrawiki.png\">\r\n\r\n*__Why?__ Ruby on Rails is a great framework for creating a full web application, but sometimes you don't need all the bells and whistles and just need something small to get a basic web page or web api up and running.  Sinatra performs this task nicely, much like the master himself [performing](https://www.youtube.com/watch?v=xMfz1jlyQrw).*  \r\n\r\n# Getting Started\r\n\r\n## *1.* Creating the application with Cloud9\r\n\r\nFollow the steps outlined in the Ruby Girls Cloud9 Sinatra Setup Guide [Could9 Setup](/cloud9-sinatra-guide)\r\n\r\n*__Why?__ With the plethora of operating systems and their versions, ruby versions, patches, gem versions and on and on it can take many frustrating hours just to get started with your coding.  This is where the beauty of [Cloud9](http://www.cloud9.com) comes in - it handles all of this for you, in the cloud, so you can have your projects set up just once and access from anywhere!  Now this doesn't mean you won't want to set up your own computer at some stage, but the good thing is it doesn't have to be today.  And when you're ready, there are many guides out there, but you probably want to have a Mac if you're serious about it, since nearly every Ruby programmer uses a Mac (or Linux if you're feeling adventurous).*\r\n\r\n## *2.* Locate the terminal window in Cloud9\r\n\r\nThere are three gems we will need to install before we can create a Sinatra project.\r\n\r\nTo install these gems, enter the following commands in the terminal window:\r\n{% highlight sh %}\r\ngem install sinatra\r\ngem install thin\r\ngem install shotgun\r\n{% endhighlight %}\r\n\r\n*__Why?__ To start with, using the terminal is often faster and provides more options than using a user interface.  While it might seem in the world of Windows, Mac OSX and the web that everything uses a mouse, when programming for Ruby and using git its often easier using the terminal to do the things you need.  \r\n\r\nThen we get to _gems_.  Gems are like the building blocks used within Ruby to provide already built bits of code that perform specific functions.  Think of a bit of code that you need to write, and odds are someone already has done it - especially if its a common task (known as _patterns_) (eg [user names and authentication](https://rubygems.org/gems/devise)).  \r\n\r\nSo for our case, these are the gems we're using:\r\n\r\n1. The first gem `sinatra` allows us to use the Sinatra DSL (Domain Specific Language) in our app.\r\n\r\n2. `Thin` is a lightweight and fast web server whose job is to serve up web pages as they are requested.\r\n\r\n3. `Shotgun` is development server that reloads our application code with each request. This means we don't need to restart the server in order to see our changes.\r\n\r\n*\r\n\r\n## *3.* Create a Gemfile\r\n\r\nWe need to manually create a Gemfile for our app. This can be done from the terminal window or the Cloud9 file explorer window.\r\n\r\nTo use the Cloud9 explorer window, right mouse-click and select `New file`. Rename this file from `Untitled` to `Gemfile`.\r\n\r\nIn the examples that follow we use the terminal window.\r\n{% highlight sh %}\r\ntouch Gemfile\r\n{% endhighlight %}\r\nA Gemfile will now appear in the Cloud9 file explorer window. Double click to open it and type in the following code which specifies which gems we want included in our application:\r\n\r\n{% highlight sh %}\r\nsource 'https://rubygems.org'\r\n\r\ngem \"sinatra\"\r\ngem \"sqlite3\"\r\ngem \"activerecord\"\r\ngem \"sinatra-activerecord\"\r\ngroup :development do\r\n    gem \"shotgun\"\r\n    gem \"tux\"\r\nend\r\n{% endhighlight %}\r\n\r\nSave the Gemfile (`cmd + s` or menu options `file -> save`).\r\n\r\nAny time you edit a Gemfile you must install the new gems. To do so, run the following command in the terminal window:\r\n\r\n{% highlight sh %}\r\nbundle install\r\n{% endhighlight %}\r\n\r\n### Quick Overview of the gems\r\n\r\nWe have included three news gems to our project:\r\n\r\n**sqlite3** is the database we will be using for this application.\r\n\r\n**activerecord** is the interface the application uses to communicate with the database.\r\n\r\n**sinatra-activerecord** is a bridge that allows us use Active Record in a Sinatra application.\r\n\r\n**tux** allows us to interact with the database through the command line.\r\n\r\n*__Why?__ A Gemfile lists all the gems that we want to use in our project.  At the start we used sinatra, thin and shotgun to get going.  Now we're adding some more ...*\r\n\r\n## *4.*Project Structure\r\n\r\nSinatra doesn’t impose any structure on your project (which can be both a blessing and a curse). The entire structure of the project is in your hands and this flexibility can cause headaches. The structure outlined in this app is a pattern that can work well for many of your future Sinatra apps.\r\n\r\nIn the next section we will focus on file and folder creation. Pay particular attention to where you create files/folders. Ask an instructor if you are unsure.\r\n\r\n### *4a.* File/Folder Creation\r\n\r\nThe instructions given will show you how to create files and folders through the terminal window. You can however create all files and folders by right clicking in the Cloud9 explorer window as we did above. If you feel comfortable with file and folder creation follow the structure in the image below and skip to section 5.\r\n\r\nFrom the terminal create a folder called `app` by executing the following command:\r\n\r\n{% highlight sh %}\r\nmkdir app\r\n{% endhighlight %}\r\n\r\nChange to the `app` folder and create three subfolders:\r\n\r\n{% highlight sh %}\r\ncd app\r\nmkdir models views controllers\r\n{% endhighlight %}\r\n\r\nYou have just create a major component of our application's structure:\r\n\r\n1. models (database communication)\r\n2. views (what the end user sees)\r\n3. controllers (lots of routes for our application)\r\n\r\nFrom the terminal window, move up one level of the project structure and into the root of the project:\r\n\r\n{% highlight sh %}\r\ncd ..\r\n{% endhighlight %}\r\n\r\nFirst we will create a folder called `files`. This folder will contain the files that we upload from our app. Next we will create a folder called `config`. Then we will create a file called `application.rb` inside the newly created `config` folder. `application.rb` is the file that will load all the files needed by our application. Finally we will create a file called `database.yml` that will manage our database connections.\r\n\r\n{% highlight sh %}\r\nmkdir files\r\nmkdir config\r\ncd config\r\ntouch application.rb\r\ntouch database.yml\r\n{% endhighlight %}\r\n\r\nFrom the terminal window, move up one level of the project structure and into the root of the project. From here create another folder called `db`. This will store information about our sqlite3 database including our database migrations.\r\n{% highlight sh %}\r\ncd ..\r\nmkdir db\r\n{% endhighlight %}\r\n\r\nWe are almost there. The final step in our skeleton structure for our application is to create a `config.ru` file in the root of the project. The `config.ru` file is a convention that is required by certain deployment procedures and tools (like shotgun, tux, and Heroku).\r\n\r\n{% highlight sh %}\r\ntouch config.ru\r\ntouch Rakefile\r\n{% endhighlight %}\r\n\r\nCongratulations! You may not realise it yet but you have just created a solid basic structure for a Sinatra app that you can reuse time and time again.\r\n\r\nBy the time our application is complete, it should look similar to the folder structure below:\r\n\r\n<img src=\"/images/sinatra_visual_tree.png\">\r\n\r\n## *5.* Setup Coding\r\n\r\nWe are now ready to begin developing our application.\r\n\r\nThe first step is to set up the `application.rb` file. Double click on the file to open it (you will find it under the `config` folder). Take some time to understand what we are about to put into this file.\r\nNote you must save all files in cloud9 (`cmd + s` or menu options `file -> save`)\r\n\r\n{% highlight sh %}\r\nrequire 'bundler'\r\nBundler.require\r\n$: << File.expand_path('../', __FILE__)\r\nDir['./app/**/*.rb'].sort.each { |file| require file }\r\nset :root, Dir['./app']\r\nset :public_folder, Proc.new { File.join(root, 'assets') }\r\nset :erb, :layout => :'layouts/application'\r\n{% endhighlight %}\r\n\r\nLets examine the first four lines in a bit more detail:\r\n\r\n**require 'bundler'** enables our application to automatically discover the Gemfile.\r\n\r\n**Bundler.require** loads into the project all the gems that are specified in the Gemfile.\r\n\r\n**$: << File.expand_path('../', __FILE__)** adds the entire project to $LOAD_PATH. This allows Sinatra to find all the files you’ve added to the project.\r\n\r\n**Dir['./app/**/*.rb'].sort.each { |file| require file }** This line explicitly requires each file found in our model, view and controller folders.\r\n\r\nEven though we haven't set them up yet, we know the project is going to need these files.\r\nThe last three lines of `application.rb` sets the root of the project and tells the application where the erb (embedded Ruby) files and CSS files are located.\r\n\r\n### *5a.* Rakefile\r\n\r\nWe need to set up our Rake file so we can run our helper tasks. Open the file `Rakefile` and add the following code:\r\n{% highlight sh %}\r\nrequire './config/application'\r\nrequire 'sinatra/activerecord/rake'\r\n{% endhighlight %}\r\n\r\n\r\nThen to make those files available in the current environment, navigate to the terminal window and run:\r\n{% highlight sh %}\r\nbundle install\r\n{% endhighlight %}\r\n\r\n### *5b.* database.yml\r\nThe final step in our setup is the `database.yml` file. This file will contain our sqlite database setup and is required for connecting to the database. Open the config folder and double click to open the file. Copy and paste the lines below.\r\n\r\n{% highlight sh %}\r\n---\r\nsqlite: &sqlite\r\n  host: 127.0.0.1\r\n  adapter: sqlite3\r\n\r\ndevelopment:\r\n  <<: *sqlite\r\n  database: db/development.sqlite3\r\n\r\nproduction:\r\n  <<: *sqlite\r\n  database: db/production.sqlite3\r\n\r\ntest:\r\n  <<: *sqlite\r\n  database: db/test.sqlite3\r\n\r\n{% endhighlight %}\r\n\r\n## *6.* Migrations\r\n\r\nJust like we did in the original Rails Girls, we need to create an `ideas` table so we can save our ideas. From the terminal window run\r\n{% highlight sh %}\r\nrake db:create_migration NAME=create_ideas\r\n{% endhighlight %}\r\n\r\nA migration file will have been created in the `db/migrate` folder. It will be called `create_ideas.rb` and be prefixed with a unique id including the date and time. Double-click to open it and enter the following. This is similar to the scaffold command you ran in Rails Girls.\r\n\r\n{% highlight sh %}\r\nclass CreateIdeas < ActiveRecord::Migration\r\n  def change\r\n    create_table :ideas do |t|\r\n      t.string :name\r\n      t.text :description\r\n      t.string :picture\r\n\r\n      t.timestamps null: false\r\n    end\r\n  end\r\n\r\n  def down\r\n    drop_table :ideas\r\n  end\r\nend\r\n{% endhighlight %}\r\n\r\nEach time we create a migration, it needs to be run so that the changes get applied to the database. Open the terminal window and type:\r\n\r\n{% highlight sh %}\r\nbundle exec rake db:migrate\r\n{% endhighlight %}\r\n\r\nThis will create the `ideas` table. You can see it in the schema file, `db/schema.rb`.\r\n\r\n## *7.* Project Code\r\nWe have just created the ideas table by running the migration, so let's now create the corresponding model. Navigate to the `app/model` folder and create the `idea.rb` file (right click in cloud9 file explorer window or use the terminal window). We will use the terminal window.\r\n\r\n{% highlight sh %}\r\ntouch idea.rb\r\n{% endhighlight %}\r\n\r\nDouble click to open the file and enter the following code:\r\n\r\n{% highlight sh %}\r\nclass Idea < ActiveRecord::Base\r\n\r\nend\r\n{% endhighlight %}\r\n\r\nThis is just an empty file at this stage, we will add code to it later on.\r\n\r\n## *8.* Routes\r\nFinally it is time to create routes. Routes are simply the rules that tell your application which code to run for a given URL. From the `controllers` folder, create a file called `ideas_controller.rb` (you can use the terminal window or cloud9 file explore window)\r\n\r\n{% highlight sh %}\r\n  %w(/ /ideas).each do |path|\r\n    get path do\r\n      @ideas = Idea.all\r\n      erb :'ideas/index'\r\n    end\r\n  end\r\n{% endhighlight %}\r\n\r\nNow that we have created our route we need to create a corresponding index page to display it. Create a folder for `ideas` in the `apps/views/` directory (from terminal window `mkdir ideas` or use the cloud9 file explorer window). Then create a file called `index.erb`.\r\n\r\n### *8a.* Views\r\nType or paste the following into the index.erb file you just created\r\n\r\n{% highlight sh %}\r\n<h1>Listing Ideas</h1>\r\n\r\n<table>\r\n  <thead>\r\n  <tr>\r\n    <th>Name</th>\r\n    <th>Description</th>\r\n    <th>Picture</th>\r\n    <th colspan=\"3\"></th>\r\n  </tr>\r\n  </thead>\r\n\r\n  <tbody>\r\n  <% @ideas.each do |idea| %>\r\n      <tr>\r\n        <td><%= idea.name %></td>\r\n        <td><%= idea.description %></td>\r\n        <td><%= idea.picture.present? %></td>\r\n        <td><a href=\"/ideas/<%= idea.id %>/edit\">Edit</a></td>\r\n        <td><a href=\"/ideas/<%= idea.id %>\">Show</a></td>\r\n        <td><% if idea.picture %><a href=\"/files/<%= idea.picture %>\">View Picture</a><% end %></td>\r\n        <td><% if idea.picture %><a href=\"/files/<%= idea.picture %>/download\">Download Picture</a><% end %></td>\r\n        <!--<td><a href=\"\"<%#= delete_idea_button(idea.id) %>-->\r\n      </tr>\r\n  <% end %>\r\n  </tbody>\r\n</table>\r\n<br>\r\n{% endhighlight %}\r\n\r\n## *9.* Improving our design\r\n\r\nAlthough our application currently has only one page, it will eventually have many pages. To give it a consistent look and feel, we will want to have the same header and footer on each page. Instead of copying and pasting the header and footer onto each page, and having to edit each page if we want to make a change, we will create one file that will contain all the common page content. This is an example of adhering to the DRY (Don't Repeat Yourself) principle of Ruby programming.\r\n\r\nCreate a subfolder of `views` folder and call it `layouts`. Then create a file in the `layout` folder and call it `application.erb`.\r\n\r\nEnter the following html/erb code:\r\n{% highlight sh %}\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Workspace</title>\r\n  <script src=\"https://code.jquery.com/jquery-2.1.4.min.js\"></script>\r\n  <!-- Latest compiled and minified CSS -->\r\n  <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css\">\r\n  <!-- Optional theme -->\r\n  <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css\">\r\n  <!-- Latest compiled and minified JavaScript -->\r\n  <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js\"></script>\r\n  <!-- Application CSS -->\r\n  <link rel=\"stylesheet\" type=\"text/css\" href=\"css/application.css\">\r\n  <!-- Application JS -->\r\n  <script src=\"js/application.js\"></script>\r\n</head>\r\n<body>\r\n<nav class=\"navbar navbar-default navbar-fixed-top\" role=\"navigation\">\r\n  <div class=\"container\">\r\n    <div class=\"navbar-header\">\r\n      <button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-collapse\">\r\n        <span class=\"sr-only\">Toggle navigation</span>\r\n        <span class=\"icon-bar\"></span>\r\n        <span class=\"icon-bar\"></span>\r\n        <span class=\"icon-bar\"></span>\r\n      </button>\r\n      <a class=\"navbar-brand\" href=\"/ideas\">The Idea app</a>\r\n    </div>\r\n    <div class=\"collapse navbar-collapse\">\r\n      <ul class=\"nav navbar-nav\">\r\n        <li class=\"active\"><a href=\"/ideas\">Home</a></li>\r\n        <li class=\"active\"><a href=\"/new\">New Idea</a></li>\r\n        <li class=\"active\"><a href=\"/about\">About Me</a></li>\r\n      </ul>\r\n      <p class=\"navbar-text pull-right\">\r\n\r\n    </div>\r\n  </div>\r\n</nav>\r\n<div class=\"container\">\r\n\r\n  <% @flash.each do |type, content| %>\r\n    <% if content.respond_to?('each') %>\r\n      <% content.each do |item| %>\r\n        <%= render 'alert',\r\n                   type:    type,\r\n                   content: item %>\r\n      <% end %>\r\n    <% end %>\r\n  <% end if @flash %>\r\n\r\n  <%= yield %>\r\n</div>\r\n<footer>\r\n  <div class=\"container\">\r\n    Ruby Girls 2016\r\n  </div>\r\n</footer>\r\n<script src=\"//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.js\"></script>\r\n</body>\r\n</html>\r\n{% endhighlight %}\r\n\r\n### *9a.* Preview in a browser\r\n\r\nIn order to start the server, you need to be in the root directory of your project. Use `cd ..` repeatedly from your terminal window until you return to your workspace. Don't worry if you go back too far, simply `cd workspace` will bring you back to where you should be. Ask an instructor if unsure.\r\n\r\nFrom the terminal window run the following to start to start the server:\r\n\r\n{% highlight sh %}\r\nruby config/application.rb -p $PORT -o $IP\r\n{% endhighlight %}\r\n\r\nFrom the cloud 9 IDE click the `share` button on the right hand upper window. The select the `copy` option and paste the url into the browser window.\r\n\r\n<img src=\"/images/c9_sinatra/c9_browser.png\">\r\n\r\nYou should now see the ideas app running in the browser! `ctrl+c` will terminate the server.\r\n\r\n## *10.* New Route and View\r\n\r\nGenerally speaking each route will have a corresponding view. Lets create a route and a view for when we want to create a new idea.\r\n\r\nOpen the `ideas_controller.rb` file and insert the following:\r\n\r\n{% highlight sh %}\r\n%w(/new /ideas/new).each do |path|\r\n  get path do\r\n    @title = 'New Idea'\r\n    @idea  = Idea.new\r\n    erb :'ideas/new'\r\n  end\r\nend\r\n{% endhighlight %}\r\n\r\nNow we need to create the HTML page to allow our users to add a new idea.\r\n\r\nNavigate to the `views/ideas` folder and create a new file called `new.erb`. Add the following code:\r\n\r\n{% highlight sh %}\r\n<h1><%=@title %></h1>\r\n<form action=\"/ideas\" method=\"post\" enctype=\"multipart/form-data\">\r\n  <label for=\"idea_name\">Name:</label><br />\r\n  <input id=\"idea_name\" name=\"idea[name]\" type=\"text\" value=\"<%= @idea.name %>\" />\r\n  <br />\r\n\r\n  <label for=\"idea_description\">Description:</label><br />\r\n  <textarea id=\"idea_description\" name=\"idea[description]\" rows=\"5\"><%= @idea.description %></textarea>\r\n  <br />\r\n\r\n  <label for=\"idea_picture\">Picture:</label><br />\r\n    <input type=\"file\" id=\"idea_picture\" name=\"idea[picture]\" rows=\"5\"><%= @idea.picture %>\r\n  <br />\r\n\r\n  <input type=\"submit\" value=\"Create Idea\" />\r\n</form>\r\n\r\n{% endhighlight %}\r\n\r\nLet's pause for a moment to review what we have just done. Our first step was to create a route for the `new` action. We did that in the `ideas_controller.rb` file.\r\n\r\nFirst, we set up two variables that will be used by the `new` HTML page, `@title` and `@idea`. `@title` is just the text that appears at the top of the web page. `@idea` is a variable that will hold all the data we will enter into our HTML page and eventually insert in to the database.\r\n\r\nFinally, with the line `erb :'ideas/new'` we defined a route that will link the URL `ideas/new` to the \"New Idea\" web page.\r\n\r\nSo we have a route that will allow users to enter a new idea but we have no way yet of allowing them to save that idea to the database. If you add the following code to `ideas_controller.rb`, we will be able to do just that.\r\n\r\n{% highlight sh %}\r\npost '/ideas' do\r\n  if params[:idea]\r\n    @idea         = Idea.new(params[:idea])\r\n    if params[:idea][:picture] && params[:idea][:picture][:filename] && params[:idea][:picture][:tempfile]\r\n      @filename     = params[:idea][:picture][:filename]\r\n      @idea.picture = @filename\r\n      file          = params[:idea][:picture][:tempfile]\r\n      FileUtils.copy_file(file.path,\"files/#{@idea.picture}\")\r\n    end\r\n    if @idea.save\r\n      redirect '/ideas'\r\n    else\r\n      erb :'ideas/new'\r\n    end\r\n  else\r\n    erb :'ideas/new'\r\n  end\r\nend\r\n{% endhighlight %}\r\n\r\n\r\n### *10a.* Preview in a browser\r\nFrom the terminal window run the following to start to start the server:\r\n\r\n{% highlight sh %}\r\nruby config/application.rb -p $PORT -o $IP\r\n{% endhighlight %}\r\n\r\nFrom the Cloud 9 IDE click the `share` button on the right hand upper window. The select the `copy` option and paste the URL into the browser window.\r\n\r\n<img src=\"/images/c9_sinatra/c9_browser.png\">\r\n\r\nYou should now see the ideas app running in the browser. ctrl + c will terminate the server.\r\n\r\n## *11.* More routes\r\n\r\nSo now we can add an idea in our app and save it to the database. But what about retrieving an idea from the database? The next route in our application will allow us to retrieve just one idea from our database.\r\n\r\nNavigate to `ideas_controller.rb` and enter the following route:\r\n\r\n{% highlight sh %}\r\n\r\nget '/ideas/:id' do\r\n  @idea = Idea.find(params[:id])\r\n  erb :'ideas/show'\r\nend\r\n{% endhighlight %}\r\n\r\nSimilar to before this route is calling `erb :'ideas/show'` so let's create that file now. Navigate to the `views/ideas` folder and create a file called `show.erb`. Add the following code:\r\n\r\n{% highlight sh %}\r\n<p>\r\n  <strong>Name:</strong>\r\n  <%= @idea.name %>\r\n</p>\r\n\r\n<p>\r\n  <strong>Description:</strong>\r\n  <%= @idea.description %>\r\n</p>\r\n\r\n<p>\r\n  <strong>Picture:</strong>\r\n  <%= @idea.picture if @idea.picture.present? %>\r\n</p>\r\n<p> <%= delete_idea_button(@idea.id) %></p>\r\n{% endhighlight %}\r\n\r\n\r\n### *11a.* Delete routes\r\n\r\nBut what if we want to delete an idea that we have previously added?\r\n\r\nNavigate to `ideas_controller.rb` and enter the following code:\r\n\r\n{% highlight sh %}\r\nhelpers do\r\n  def delete_idea_button(idea_id)\r\n    erb :'ideas/_delete_idea_button', locals: { idea_id: idea_id }\r\n  end\r\nend\r\n{% endhighlight %}\r\n\r\nThis is called a helper route. It is referring to a view called `ideas/_delete_idea_button` so let's create that.\r\n\r\nNavigate to the `views/ideas` folder and create a new file called `_delete_idea_button.erb`. Be sure to include the underscore.\r\n\r\nOpen the newly created file and enter the following code:\r\n\r\n{% highlight sh %}\r\n<form action=\"/ideas/<%= idea_id %>\" method=\"post\">\r\n  <input type=\"hidden\" name=\"_method\" value=\"delete\" />\r\n  <input type=\"submit\" value=\"Delete Idea\" />\r\n</form>\r\n{% endhighlight %}\r\n\r\nFinally we need to create the route that will do the actual deleting. Return to the `ideas_controller.rb` file and enter the following\r\n\r\n{% highlight sh %}\r\ndelete '/ideas/:id' do\r\n  @idea = Idea.find(params[:id]).destroy\r\n  redirect '/ideas'\r\nend\r\n{% endhighlight %}\r\n\r\nLets preview our changes in the browser. From the terminal window run the following to start to start the server:\r\n\r\n{% highlight sh %}\r\nruby config/application.rb -p $PORT -o $IP\r\n{% endhighlight %}\r\n\r\n### *11b.* Updating that one Idea\r\n\r\nWe are almost done! The final piece of database functionality it to retrieve a single idea and update it. As we did in the previous steps, let's start by creating a new route. Add the following code to `ideas_controller.rb`:\r\n\r\n{% highlight sh %}\r\nget '/ideas/:id/edit' do\r\n  @idea = Idea.find(params[:id])\r\n  erb :'ideas/edit'\r\nend\r\n{% endhighlight %}\r\n\r\nAgain we see the route is calling a view `erb :'ideas/edit'`. Lets create it by navigating to `views/ideas` and creating\r\na file called `edit.erb` with the following code:\r\n\r\n{% highlight sh %}\r\n\r\n<h1>Edit Post</h1>\r\n<form action=\"/ideas/<%= @idea.id %>\" method=\"post\" enctype=\"multipart/form-data\">\r\n  <input type=\"hidden\" name=\"_method\" value=\"put\" />\r\n\r\n  <label for=\"idea_name\">Name:</label><br />\r\n  <input id=\"idea_description\" name=\"idea[name]\" type=\"text\" value=\"<%= @idea.name %>\" />\r\n  <br />\r\n\r\n  <label for=\"idea_description\">Description:</label><br />\r\n  <textarea id=\"idea_description\" name=\"idea[description]\" rows=\"5\"><%= @idea.description %></textarea>\r\n  <br />\r\n\r\n  <label for=\"idea_picture\">Picture:</label><br />\r\n  <input type=\"file\" id=\"idea_picture\" name=\"idea[picture]\" rows=\"5\"><%= @idea.picture %>\r\n  <br />\r\n\r\n  <input type=\"submit\" value=\"Update Idea\" />\r\n</form>\r\n{% endhighlight %}\r\n\r\nAs with the `new` action above, we know we will need to create a second route to update the database with the new data. Navigate back into `ideas_controller.rb` and add the following code:\r\n\r\n{% highlight sh %}\r\nput '/ideas/:id' do\r\n  if params[:idea].try(:[], :picture)\r\n    file      = params[:idea][:picture][:tempfile]\r\n    @filename = params[:idea][:picture][:filename]\r\n  end\r\n\r\n  @idea = Idea.find(params[:id])\r\n\r\n  if @idea.update_attributes(params[:idea])\r\n    if @filename\r\n      @idea.picture = @filename\r\n      @idea.save\r\n      File.open(\"./files/#{@filename}\", 'wb') do |f|\r\n        f.write(file.read)\r\n      end\r\n    end\r\n    redirect \"/ideas/#{@idea.id}\"\r\n  else\r\n    erb :'ideas/edit'\r\n  end\r\nend\r\n\r\n{% endhighlight %}\r\n\r\nLets preview our changes in the browser. From the terminal window run the following to start to start the server:\r\n\r\n{% highlight sh %}\r\nruby config/application.rb -p $PORT -o $IP\r\n{% endhighlight %}\r\n\r\nWe have left out an important route for our app: managing the files we uploaded. To keep things simple let's create a new controller that will deal with the files in our app.\r\n\r\nNavigate to the `apps/controllers` folder and create a new controller called `files_controller.rb`. Add the following code to create the required routes:\r\n\r\n{% highlight sh %}\r\nget '/files/:filename/download' do |filename|\r\n  send_file \"./files/#{filename}\", :filename => filename, :type => 'Application/octet-stream'\r\nend\r\n\r\nget '/files/:filename' do |filename|\r\n  send_file \"./files/#{filename}\"\r\nend\r\n{% endhighlight %}\r\n\r\nLet's try to download or view our files in the browser. From the terminal window run the following to start to start the server:\r\n\r\n{% highlight sh %}\r\nruby config/application.rb -p $PORT -o $IP\r\n{% endhighlight %}\r\n\r\n## *12.* CSS\r\n\r\nLets add some css to our app.\r\n\r\nUsing the terminal window `cd` into the app folder and then do the following (again you can use the Cloud9 file explore window to create these folders)\r\n\r\n{% highlight sh %}\r\ncd app\r\nmkdir assets\r\ncd assets\r\nmkdir css\r\ntouch application.css\r\n{% endhighlight %}\r\n\r\nLets open our newly created `application.css` file and add the following code:\r\n\r\n{% highlight sh %}\r\nbody { padding-top: 100px; }\r\nfooter { margin-top: 100px; }\r\ntable, td, th { vertical-align: middle; border: none; color: brown; }\r\nth { border-bottom: 1px solid #DDD; }\r\n{% endhighlight %}\r\n\r\nLet's preview our changes in the browser. From the terminal window run the following to start to start the server:\r\n\r\n{% highlight sh %}\r\nruby config/application.rb -p $PORT -o $IP\r\n{% endhighlight %}\r\n\r\n## *13.* Heroku\r\n\r\nFollowing the heroku guide [Pushing to Heroku](/heroku)\r\n\r\n## *14.* Github\r\n\r\nFinally we should push all our code to Github.\r\n\r\nLog onto Github and create a new repository\r\n\r\n<img src=\"/images/github_new_repo.png\">\r\n\r\nGive your repo a title and a description\r\n\r\n<img src=\"/images/github_create_repo.png\">\r\n\r\nFollow the instructions on Github under the heading `…or push an existing repository from the command line`\r\n\r\nThey will be similar to below. DO NOT copy the lines below. You must push to your own newly created repo\r\n\r\n{% highlight sh %}\r\ngit remote add origin https://github.com/YourName/project_name.git\r\ngit push -u origin master\r\n{% endhighlight %}\r\n\r\n\r\n## *15.* The End\r\n\r\nEvery app should be accompanied by a README.md document. Edit this file with details about your app and push this update to Github (use the steps outlined above)\r\n\r\nCongratulations you have just completed your first Sinatra app!","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}